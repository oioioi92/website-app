# 前后台连接 检查清单

后台（admin1167.net）与前台（admin1167.com）互连是否可用，按下面逐项检查。

---

## 一、代码与配置（本仓库已具备）

| 项 | 文件 | 状态 |
|----|------|------|
| 中间件接入 proxy | `middleware.ts` | ✅ 已创建，请求会走 `proxy(req)` |
| 前后台跳转逻辑 | `proxy.ts` | ✅ 生产环境下：后台域名访问 `/` 或非 /admin 路径 → 跳前台；前台访问 /admin → 跳后台 |
| 侧栏「打开前台」 | `components/admin/Sidebar.tsx` | ✅ 底部有按钮，链接为 `NEXT_PUBLIC_FRONTEND_URL ?? "/"` |
| 环境变量说明 | `.env.example` | ✅ 含 `FRONTEND_DOMAIN`、`ADMIN_DOMAIN`、`NEXT_PUBLIC_FRONTEND_URL` |

---

## 二、服务器 / 部署环境 需确认

| 项 | 说明 |
|----|------|
| **FRONTEND_DOMAIN** | 项目根目录 `.env` 中需有，如 `FRONTEND_DOMAIN="admin1167.com"`（与 proxy 默认一致可省略） |
| **ADMIN_DOMAIN** | 同上，如 `ADMIN_DOMAIN="admin1167.net"` |
| **NODE_ENV=production** | 跳转仅在 `NODE_ENV=production` 时生效；`npm run build` + `npm start` 或 PM2 通常已是 production |
| **NEXT_PUBLIC_FRONTEND_URL** | 可选。填 `https://admin1167.com` 时，侧栏「打开前台」直接打开该地址；不填则用 `/`，依赖当前域名 + middleware 跳转 |

---

## 三、自检步骤

1. **后台 → 前台**  
   在浏览器打开 `https://admin1167.net/admin`，登录后点侧栏底部 **「打开前台」**。  
   - 应在新标签页打开 `https://admin1167.com`（或先到 admin1167.net/ 再被跳转到 admin1167.com）。

2. **前台 → 后台**  
   在浏览器打开 `https://admin1167.com`，再访问 `https://admin1167.com/admin`。  
   - 应被 307 重定向到 `https://admin1167.net/admin`。

3. **本地开发**  
   本地 `npm run dev` 时 `NODE_ENV` 为 development，**不会**做前后台域名跳转；侧栏「打开前台」若未设 `NEXT_PUBLIC_FRONTEND_URL` 会打开当前站点的 `/`，属预期。

---

## 四、常见问题

| 现象 | 可能原因 |
|------|----------|
| 点「打开前台」没反应或打开错页 | 未配置 `NEXT_PUBLIC_FRONTEND_URL` 且当前访问的不是 admin1167.net；或部署后未重新 build。 |
| 访问 admin1167.com/admin 没有跳到 .net | 未以 production 运行；或 `.env` 未配置 `FRONTEND_DOMAIN` / `ADMIN_DOMAIN`。 |
| 本地想试跳转 | 本地把 `FRONTEND_DOMAIN` / `ADMIN_DOMAIN` 改成 localhost 不同端口通常不现实，建议在服务器或预发环境验证。 |

---

**结论**：代码与示例配置已就绪；在服务器 `.env` 中配好 `FRONTEND_DOMAIN`、`ADMIN_DOMAIN`，并以 production 部署后，前后台连接即可使用。
